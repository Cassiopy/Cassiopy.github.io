<!doctype html>
<html lang="es">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Fiesta de Navidad</title>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700;900&family=Montserrat:wght@300;400;500;600;700&family=Great+Vibes&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    <!-- Decorative stars background -->
    <div class="stars-bg">
      <div class="star star-1"></div>
      <div class="star star-2"></div>
      <div class="star star-3"></div>
      <div class="star star-4"></div>
      <div class="star star-5"></div>
      <div class="star star-6"></div>
      <div class="star star-7"></div>
      <div class="star star-8"></div>
    </div>

    <!-- Music player -->
    <div class="music-player">
      <audio id="bg-music" loop autoplay muted playsinline>
        <source src="Dua Lipa - Levitating Featuring DaBaby (Official Music Video) - Dua Lipa.mp3" type="audio/mpeg">
        Tu navegador no soporta el elemento de audio.
      </audio>
      <button id="music-btn" class="music-btn" title="Reproducir mÃºsica">ğŸµ</button>
      <input id="volume-slider" class="volume-slider" type="range" min="0" max="100" value="30">
    </div>

    <main class="invite-container">
      <!-- Header with title -->
      <section class="header-section">
        <div class="header-stars">
          <span class="header-star">âœ¦</span>
          <span class="header-star">âœ¦</span>
          <span class="header-star">âœ¦</span>
        </div>
        
        <h1 class="title-main">Fiesta de</h1>
        <h1 class="title-main title-highlight">Navidad</h1>
        
        <p class="subtitle-text" id="greeting">Te invitamos a celebrar,</p>
        
        <div class="header-stars">
          <span class="header-star">âœ¦</span>
          <span class="header-star">âœ¦</span>
          <span class="header-star">âœ¦</span>
        </div>
      </section>

      <!-- Event details section -->
      <section class="details-section">
        <div class="detail-item">
          <span class="detail-icon">ğŸ“…</span>
          <div>
            <p class="detail-label">Fecha</p>
            <p class="detail-value">24 de Diciembre</p>
          </div>
        </div>

        <div class="detail-item">
          <span class="detail-icon">ğŸ•–</span>
          <div>
            <p class="detail-label">Hora</p>
            <p class="detail-value">18:00 hs</p>
          </div>
        </div>

        <div class="detail-item">
          <span class="detail-icon">ğŸ“</span>
          <div>
            <p class="detail-label">Lugar</p>
            <p class="detail-value">Alkimia del RÃ­o, Los CastaÃ±os 279, Potrero de los Funes</p>
          </div>
        </div>
      </section>

      <!-- Map section -->
      <section class="map-section">
        <h2 class="section-title">Â¿CÃ³mo llegar?</h2>
        <div class="map-container">
          <a href="https://maps.app.goo.gl/THjNdM86CqrpGS9E7" target="_blank" class="map-link">
            ğŸ“ Abrir en Google Maps
          </a>
          <iframe 
            src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d1677.5169206999995!2d-66.22800160000001!3d-33.21498690000001!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x95d4150067ba63d3%3A0xc49814a3c24f9549!2sAlkimia%20del%20R%C3%ADo!5e0!3m2!1ses!2sar!4v1700000000000" 
            loading="lazy" 
            referrerpolicy="no-referrer-when-downgrade"
            class="map-iframe">
          </iframe>
        </div>
      </section>

      <!-- Photos section -->
      <section class="photos-section">
        <h2 class="section-title">ğŸ“¸ Compartir Fotos</h2>
        <p class="section-description">Guarda las fotos de la fiesta en nuestra carpeta compartida pÃºblica:</p>
        <a href="https://drive.google.com/drive/folders/10lwMtG7bVBI4earde9lrx412ZOsm0m42?usp=sharing" target="_blank" class="cta-button">
          ğŸ“ Abrir Google Drive
        </a>
      </section>

      <!-- Footer -->
      <footer class="footer-section">
        <p class="footer-text">Â¡Te esperamos!</p>
        <p class="footer-hosts">Sofi y Maxi</p>
      </footer>
    </main>

    <!-- Scripts -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>

    <script>
      // Personalization: read ?to=Name
      function getParam(name) {
        const url = new URL(window.location.href);
        return url.searchParams.get(name);
      }

      const toName = getParam('to');
      const greeting = document.getElementById('greeting');
      if (toName) {
        greeting.textContent = `${decodeURIComponent(toName)}, te invitamos a celebrar`;
      }

      // Music player
      const bgMusic = document.getElementById('bg-music');
      const musicBtn = document.getElementById('music-btn');
      const volumeSlider = document.getElementById('volume-slider');

      // Set initial volume
      bgMusic.volume = 0.3;

      // Try autoplay immediately
      const attemptAutoplay = () => {
        bgMusic.muted = false;
        const playPromise = bgMusic.play();
        
        if (playPromise !== undefined) {
          playPromise
            .then(() => {
              console.log('Autoplay successful');
              musicBtn.textContent = 'â¸ï¸';
            })
            .catch(err => {
              console.log('Autoplay failed, attempting workaround...');
              // Workaround: create a dummy audio to trigger autoplay permission
              const dummyAudio = new Audio();
              dummyAudio.src = bgMusic.src;
              dummyAudio.muted = true;
              dummyAudio.play().then(() => {
                // Now try again with real audio
                bgMusic.play().then(() => {
                  musicBtn.textContent = 'â¸ï¸';
                }).catch(e => {
                  console.log('Second attempt failed:', e);
                  // Final fallback: wait for user interaction
                  setupInteractionPlay();
                });
              }).catch(e => {
                console.log('Dummy audio failed:', e);
                setupInteractionPlay();
              });
            });
        }
      };

      const setupInteractionPlay = () => {
        const playOnInteract = () => {
          bgMusic.muted = false;
          bgMusic.play().then(() => {
            musicBtn.textContent = 'â¸ï¸';
            document.removeEventListener('click', playOnInteract);
            document.removeEventListener('touchstart', playOnInteract);
          }).catch(e => console.log('Play error:', e));
        };
        document.addEventListener('click', playOnInteract, { once: true });
        document.addEventListener('touchstart', playOnInteract, { once: true });
      };

      // Start autoplay attempt when page loads
      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', attemptAutoplay);
      } else {
        attemptAutoplay();
      }

      musicBtn.addEventListener('click', () => {
        if (bgMusic.paused) {
          bgMusic.play().catch(err => console.log('Play error:', err));
          musicBtn.textContent = 'â¸ï¸';
        } else {
          bgMusic.pause();
          musicBtn.textContent = 'ğŸµ';
        }
      });

      volumeSlider.addEventListener('input', () => {
        bgMusic.volume = volumeSlider.value / 100;
      });

      // Update button state on play/pause
      bgMusic.addEventListener('play', () => {
        musicBtn.textContent = 'â¸ï¸';
      });
      bgMusic.addEventListener('pause', () => {
        musicBtn.textContent = 'ğŸµ';
      });

    </script>
  </body>
</html>
